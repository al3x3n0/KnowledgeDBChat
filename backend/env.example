# Database Configuration
DATABASE_URL=postgresql://user:password@localhost:5432/knowledge_db
REDIS_URL=redis://localhost:6379/0

# LLM Configuration
# Provider can be 'ollama' (local) or 'deepseek' (external)
LLM_PROVIDER=ollama
OLLAMA_BASE_URL=http://localhost:11434
DEFAULT_MODEL=llama2
EMBEDDING_MODEL=all-MiniLM-L6-v2

# DeepSeek (optional, only if LLM_PROVIDER=deepseek)
# Note: Using DeepSeek sends data to an external API. Enable only if allowed.
DEEPSEEK_API_BASE=https://api.deepseek.com/v1
DEEPSEEK_API_KEY=your-deepseek-api-key
DEEPSEEK_MODEL=deepseek-chat
DEEPSEEK_TIMEOUT_SECONDS=120
DEEPSEEK_MAX_RESPONSE_TOKENS=2000

# RAG Configuration
RAG_HYBRID_SEARCH_ENABLED=true
RAG_HYBRID_SEARCH_ALPHA=0.7
RAG_RERANKING_ENABLED=true
RAG_RERANKING_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
RAG_RERANKING_TOP_K=5
RAG_MAX_CONTEXT_TOKENS=4000
RAG_MIN_RELEVANCE_SCORE=0.3
RAG_CHUNKING_STRATEGY=semantic
RAG_QUERY_EXPANSION_ENABLED=true
RAG_MMR_ENABLED=true
RAG_MMR_LAMBDA=0.5
RAG_DEDUPLICATION_ENABLED=true
RAG_DEDUPLICATION_THRESHOLD=0.95

# ChromaDB Configuration (only if VECTOR_STORE_PROVIDER=chroma)
CHROMA_PERSIST_DIRECTORY=./data/chroma_db
CHROMA_COLLECTION_NAME=knowledge_base

# Vector Store Provider
# VECTOR_STORE_PROVIDER can be:
# - chroma  (embedded)
# - qdrant  (service)
VECTOR_STORE_PROVIDER=qdrant

# Qdrant (only if VECTOR_STORE_PROVIDER=qdrant)
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=
QDRANT_COLLECTION_NAME=knowledge_base

# Security
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Application Configuration
DEBUG=True
HOST=0.0.0.0
PORT=8000
WORKERS=1

# Data Sources Configuration
GITLAB_URL=https://gitlab.company.com
GITLAB_TOKEN=your-gitlab-token
CONFLUENCE_URL=https://company.atlassian.net
CONFLUENCE_USER=your-username
CONFLUENCE_API_TOKEN=your-api-token

# Celery Configuration
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Logging
LOG_LEVEL=INFO
LOG_FILE=./data/logs/app.log

# Summarization
# Threshold above which summarization is treated as heavy and routed to DeepSeek if configured
SUMMARIZATION_HEAVY_THRESHOLD_CHARS=30000
# Per-chunk size and overlap for chunked document summaries
SUMMARIZATION_CHUNK_SIZE_CHARS=12000
SUMMARIZATION_CHUNK_OVERLAP_CHARS=800

# LaTeX Studio (disabled by default)
LATEX_COMPILER_ENABLED=false
LATEX_COMPILER_ADMIN_ONLY=true
LATEX_COMPILER_TIMEOUT_SECONDS=20
LATEX_COMPILER_MAX_SOURCE_CHARS=200000
LATEX_PROJECT_MAX_FILE_SIZE=26214400
LATEX_COMPILER_RUN_BIBTEX=true
LATEX_COMPILER_USE_CELERY=false
LATEX_COMPILER_CELERY_QUEUE=latex
LATEX_COMPILER_JOB_QUEUED_STALE_SECONDS=600
LATEX_COMPILER_JOB_RUNNING_STALE_SECONDS=300

# Kroki (Mermaid diagram rendering)
# Local Kroki Docker container for diagram rendering
KROKI_URL=http://localhost:8001
# External fallback if local is unavailable
KROKI_FALLBACK_URL=https://kroki.io
# Enable fallback to external service
KROKI_USE_FALLBACK=true

# Custom Tools
# Docker container tools require access to a Docker daemon; keep disabled by default.
CUSTOM_TOOL_DOCKER_ENABLED=false

# Agent governance (writes)
# Allow autonomous agent jobs to directly apply patch diffs to KB documents.
# Strongly recommended to keep disabled and use PatchPR review/merge instead.
AGENT_KB_PATCH_APPLY_ENABLED=false
